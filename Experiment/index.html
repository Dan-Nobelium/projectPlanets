<!DOCTYPE html>
<html>
  <head>
	<title>My experiment</title>
	<script src="jspsych-6.1.0/jspsych.js"></script>
	<link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
	<script src="jspsych-6.1.0/plugins/jspsych-html-button-response.js"></script>
	<script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
	<script src="jspsych-6.1.0/plugins/planet-response.js"></script>
	
  </head>
  <body>

  </body>
  <script>

	//Initialise timeline
	var timeline = [];

	// Define general instructions
	var instr_gen = {
		type: 'html-button-response',
		stimulus: 'General instructions go here.',
		choices: ['Click this button to proceed.'],
	}
	timeline.push(instr_gen);

	// Define pre-block instructions
	var instr_p1 = {
		type: 'html-button-response',
		stimulus: 'Pre-block instructions go here.',
		choices: ['Click this button to proceed.'],
	}
	timeline.push(instr_p1);


	//Define some global variables
	var block_number = 0;
	var trial_number = 0;
	var points = 0;
	var continuousResp = true;
	var nBlocks_p1 = 2;
	var nBlocks_p2 = 3;

	var nTrialspBlk = 5; //if continuousResp is true though, this doesn't matter
	if (continuousResp){
		var nTrialspBlk = 1; 
	}

	var planet_noship = {
		type: 'planet-response',
		stimulus: ['img/bluep.png','img/orangep.png'],
		stimulus_select:'img/selectring.png',
		prompt: ['Planet A','Planet B'], 
		ship_stimulus: ['img/ship1.png','img/ship2.png'],
		show_ship: false,
		block_duration: 10 * 1000, //in milliseconds
		data: {block_type:'planet_noship',
			   block_number:block_number,
			   trial_number:trial_number,
			   },
		on_start: function(trial){
			trial.data.points = points;
			trial.data.block_number = block_number;
			trial.data.trial_number = trial_number;
		},
		on_finish: function(data){
			points = data.points_total;
			trial_number = data.trial_number;
			trial_number++;
			//Script for continuous response block
			if (continuousResp){
				jsPsych.endCurrentTimeline();
				block_number = data.block_number;			
				block_number++
				console.log('Block ' + block_number)
			} else {
				if (trial_number>=nTrialspBlk){
					trial_number = 0
					block_number = data.block_number;			
					block_number++
					console.log('Block ' + block_number)
				}
			}
				
		}		
	}

	//Loop over specified number of blocks
	for (var i=0; i<nBlocks_p1; i++){
		var block_noship = {
			timeline: [planet_noship],
			repetitions: nTrialspBlk,
		}
		timeline.push(block_noship)
		//value check p1
		var value_p1 = {
			type: 'html-button-response',
			stimulus: 'Value check first phase.',
			choices: ['Click this button to proceed.'],
		}
		var infer_p1 = {
			type: 'html-button-response',
			stimulus: 'Inference check first phase. ',
			choices: ['Click this button to proceed.'],
		}
		
		timeline.push(value_p1);
		timeline.push(infer_p1);
	}

	// Push next block
	// Define pre-block instructions
	var instr_p2 = {
		type: 'html-button-response',
		stimulus: 'Pre-block instructions with pirate warnings? go here.',
		choices: ['Click this button to proceed.'],
	}
	timeline.push(instr_p2);

	//Copy a planet with ship version from noship
	var planet_ship = Object.assign({},planet_noship); //Note that nested objects might not be copied and simply referenced? Be careful when trying to edit nested objects. Will probably need to clone them separately.
	planet_ship.show_ship = true;
	planet_ship.data = Object.assign({},planet_noship.data)
	planet_ship.data.block_type = 'planet_ship';
	//Push specified number of blocks into timeline
	for (var i=0; i<nBlocks_p2; i++){
		var block_ship = {
			timeline: [planet_ship],
			repetitions: nTrialspBlk,
		}
		timeline.push(block_ship)
		//value check p2
		var value_p2 = {
			type: 'html-button-response',
			stimulus: 'Value check second phase.',
			choices: ['Click this button to proceed.'],
		}
		var infer_p2 = {
			type: 'html-button-response',
			stimulus: 'Inference check second phase.',
			choices: ['Click this button to proceed.'],
		}
		
		timeline.push(value_p2);
		timeline.push(infer_p2);
	}

	// Final page/debrief?
	var finalpg = {
		type: 'html-button-response',
		stimulus: 'Final page. Some debriefing info?',
		choices: ['Click this button to proceed.'],
	}
	timeline.push(finalpg)

	//Start experiment
	jsPsych.init({
		timeline: timeline,
		preload_images: ['img/signal1.png','img/signal2.png','img/signal3.png','img/signal4.png',
						 'img/ship1.png','img/ship2.png',
						 'img/bluep.png','img/orangep.png',
						 'img/cursor.png','img/cursordark.png',
						 'img/selectring.png'],
		
		on_finish: function(){
			jsPsych.data.displayData();
		},

	})

  </script>
</html>
